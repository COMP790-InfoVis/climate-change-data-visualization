<!DOCTYPE html>
<meta charset="utf-8">

<!-- Load d3.js -->
<script src="http://d3js.org/d3.v4.js"></script>
<script src="https://d3js.org/d3-scale-chromatic.v1.min.js"></script>
<script src="https://d3js.org/d3-geo-projection.v2.min.js"></script>

<!-- Create an element where the map will take place -->
<svg id="my_dataviz" width="1500" height="800"></svg>

<script>

// The svg
var svg = d3.select("svg"),
  width = +svg.attr("width"),
  height = +svg.attr("height");

// Map and projection
var projection = d3.geoMercator()
  .scale(150)
  .center([0,20])
  .translate([width / 2, height / 2]);
var path = d3.geoPath(projection);

// Data and color scale
var data = d3.map();
//console.log(data)
var colorScale = d3.scaleThreshold()
  .domain([-20,-10, 0, 10, 20, 35])
  .range(d3.schemeReds[7]);

// Load external data and boot
d3.queue()
  .defer(d3.json, "https://raw.githubusercontent.com/holtzy/D3-graph-gallery/master/DATA/world.geojson")
  .defer(d3.csv, "average_yearly_temperatures_celcius_1901-2021_world.csv", function(d) { data.set(d.country, +d.temp1901, +d.temp1902, +d.temp1903, +d.temp1904, +d.temp1905, +d.temp1906, +d.temp1907, +d.temp1908, +d.temp1909, +d.temp1910, +d.temp1911, +d.temp1912, +d.temp1913, +d.temp1914, +d.temp1915, +d.temp1916, +d.temp1917, +d.temp1918, +d.temp1919, +d.temp1920, +d.temp1921, +d.temp1922, +d.temp1923, +d.temp1924, +d.temp1925, +d.temp1926, +d.temp1927, +d.temp1928, +d.temp1929, +d.temp1930, +d.temp1931, +d.temp1932, +d.temp1933, +d.temp1934, +d.temp1935, +d.temp1936, +d.temp1937, +d.temp1938, +d.temp1939, +d.temp1940, +d.temp1941, +d.temp1942, +d.temp1943, +d.temp1944, +d.temp1945, +d.temp1946, +d.temp1947, +d.temp1948, +d.temp1949, +d.temp1950, +d.temp1951, +d.temp1952, +d.temp1953, +d.temp1954, +d.temp1955, +d.temp1956, +d.temp1957, +d.temp1958, +d.temp1959, +d.temp1960, +d.temp1961, +d.temp1962, +d.temp1963, +d.temp1964, +d.temp1965, +d.temp1966, +d.temp1967, +d.temp1968, +d.temp1969, +d.temp1970, +d.temp1971, +d.temp1972, +d.temp1973, +d.temp1974, +d.temp1975, +d.temp1976, +d.temp1977, +d.temp1978, +d.temp1979, +d.temp1980, +d.temp1981, +d.temp1982, +d.temp1983, +d.temp1984, +d.temp1985, +d.temp1986, +d.temp1987, +d.temp1988, +d.temp1989, +d.temp1990, +d.temp1991, +d.temp1992, +d.temp1993, +d.temp1994, +d.temp1995, +d.temp1996, +d.temp1997, +d.temp1998, +d.temp1999, +d.temp2000, +d.temp2001, +d.temp2002, +d.temp2003, +d.temp2004, +d.temp2005, +d.temp2006, +d.temp2007, +d.temp2008, +d.temp2009, +d.temp2010, +d.temp2011, +d.temp2012, +d.temp2013, +d.temp2014, +d.temp2015, +d.temp2016, +d.temp2017, +d.temp2018, +d.temp2019, +d.temp2020, +d.temp2021);})
  .await(ready);

function ready(error, topo) {

let mouseOver = function(d) {
  d3.selectAll(".country")
    .transition()
    .duration(200)
    .style("opacity", .5)
  d3.select(this)
    .transition()
    .duration(200)
    .style("opacity", 1)
    .style("stroke", "black")
}

let mouseLeave = function(d) {
  d3.selectAll(".country")
    .transition()
    .duration(200)
    .style("opacity", .8)
  d3.select(this)
    .transition()
    .duration(200)
    .style("stroke", "transparent")
}

  // Draw the map
  svg.append("g")
    .selectAll("path")
    .data(topo.features)
    .enter()
    .append("path")
      // draw each country
      .attr("d", d3.geoPath()
        .projection(projection)
      )
      // set the color of each country
      .attr("fill", function (d) {
        d.total = data.get(d.properties.name) || -20;
       // console.log(d.total)
        return colorScale(d.total);
        
      })
      .style("stroke", "black")
      .style("opacity", .8)
      .attr("class", function(d){ return "country"} )
      .on("mouseover", mouseOver )
      .on("mouseleave", mouseLeave )
    }

</script>